if(!window.Shared)window.Shared={};Shared.Common=new function(){var e="ui-state-highlight",d="#userMessage",_my=this;_my.ProgressImageUrl="/content/progress.gif";_my.ProgressImage='<img src="'+_my.ProgressImageUrl+'" />';_my.SuggestTagsUrl="/Works/SuggestTags";_my.InitialUserMessage=null;_my.Ready=function(){var a="#txtSearch";$(a).autocomplete("/Music/AutoCompleteSearchTerm/",{delay:40,selectFirst:true,multiple:true,highlight:false});$("#lnkSearch").click(function(e){e.preventDefault();var b=$(a),d=b.val();if(d!=""){var c=$(this).parents("form");c.submit()}});$(".navTab").each(function(){var a=$(this),c=a.find("a"),b=c.attr("href");if(document.location.href.indexOf(b)!=-1){a.addClass("ui-state-active");return false}});$(d).click(function(){$(d).fadeOut(100)});_my.InitialUserMessage!=null&&_my.ShowUserMessage(_my.InitialUserMessage)};_my.HijaxButtonHoverStates=function(){var a="ui-state-hover";$(".fg-button:not(.ui-state-disabled)").hover(function(){$(this).addClass(a)},function(){$(this).removeClass(a)})};_my.ShowUserMessage=function(a){var b=$(d);b.toggleClass("ui-state-error",a.Type==0).toggleClass(e,a.Type==1).toggleClass("Warning",a.Type==2).html(a.Message).show();a.Type!=0&&b.delay(2500).fadeOut(100)};_my.ShowUserMessages=function(c){var a=$(d);a.toggleClass(e);a.empty();var b=true;$.each(c,function(e,c){a.append($("<div></div>"));var d=a.find("div:last");d.toggleClass("Error",c.Type==0);d.toggleClass("Info",c.Type==1);d.toggleClass("Warning",c.Type==2);d.html(c.Message);if(c.Type==0)b=false});a.show();b&&a.delay(2500).fadeOut(100)};_my.IsEmpty=function(a){return a.replace(/\s/g,"")==""};_my.FileSize=function(a){var c=["bytes","kb","MB","GB","TB","PB"],b=Math.floor(Math.log(a)/Math.log(1024));return (a/Math.pow(1024,Math.floor(b))).toFixed(2)+" "+c[b]};_my.ParseJson=function(jsonString){return eval("("+jsonString+")")}};$(function(){Shared.Common.Ready();Shared.Common.HijaxButtonHoverStates()});if(!window.Shared)window.Shared={};Shared.WorkList=new function(){var g=null,f="blind",e="destroy",c=false,b="html",a="GET",d="href",h=this;h.HijaxImageLinks=function(){$(".imageLink").click(function(h){h.preventDefault();var i=$(this).attr(d),f=$("#lightBox"),g=$(h.target).attr("title");if(Shared.Common.IsEmpty(g))g="View Image";f.attr("title",g);f.dialog({height:450,width:430,modal:true,overlay:{backgroundColor:"#000",opacity:.5},open:function(){f.html(Shared.Common.ProgressImage);$.ajax({type:a,url:i,dataType:b,cache:c,success:function(a){f.html(a)},error:function(a){f.html(a.responseText)}})},close:function(){f.dialog(e)}})})};h.HijaxProfileLinks=function(){$(".expandProfile").click(function(j){j.preventDefault();var e=$(this).next(".profileContainer");e.toggle(f,g,200);if(Shared.Common.IsEmpty(e.html())){e.html(Shared.Common.ProgressImage);var i=$(this).attr(d);$.ajax({type:a,url:i,dataType:b,cache:c,success:function(a){e.html(a);h.HijaxImageLinks()},error:function(a){e.html(a.responseText)}})}})};h.HijaxCommentLinks=function(){$(".expandComm").click(function(j){j.preventDefault();var h=$(this),e=h.next(".commBox");e.toggle(f,g,200);if(Shared.Common.IsEmpty(e.html())){e.html(Shared.Common.ProgressImage);var i=h.attr(d);$.ajax({type:a,url:i,dataType:b,cache:c,success:function(a){e.html(a);Comments.CommentList.HijaxComments()},error:function(a){e.html(a.responseText)}})}})};h.HijaxDescriptionLinks=function(){$(".expandDescription").click(function(l){l.preventDefault();var e=$(this),h=e.parent().find(".descriptionContainer"),j=e.prev(".descriptionTruncated");j.toggle(f,g,200);h.toggle(f,g,200);if(Shared.Common.IsEmpty(h.html())){h.html(Shared.Common.ProgressImage);var k=e.attr(d);$.ajax({type:a,url:k,dataType:b,cache:c,success:function(a){h.html(a)},error:function(a){h.html(a.responseText)}})}var i="Read More";if(e.html()==i)e.html("Close");else e.html(i)})};h.HijaxDownloadLinks=function(){$(".downloadButton").click(function(h){h.preventDefault();var g=$(this).attr(d),f=$("#downloadWindow");f.dialog({height:400,width:600,modal:true,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Cancel:function(){f.dialog(e)}},open:function(){f.html(Shared.Common.ProgressImage);$.ajax({type:a,url:g,dataType:b,cache:c,success:function(a){f.html(a);Music.DownloadForm.Ready()},error:function(a){f.html(a.responseText)}})},close:function(){f.dialog(e)}})})}};if(!window.Shared)window.Shared={};Shared.PlayerManager=new function(){var y=".audioWorkTitle",x=".playCollectionButton",m=".playerContainer",i=".playTrackButton",l=".player",C="trackIndex",n=".trackRow",w="Play",v="ui-priority-secondary",u="title",t="span",s="ui-icon-play",r="ui-icon-pause",q="span.ui-icon",p=":visible",E=".trackList",h=".collectionContainer",b="playing",a="paused",e="stopped",k="href",f=null,B=".expandContainer",c=false,V=this,j,D,K=c,P=c,d,g,G="";V.SetupPlayers=function(){var d=true;if($.browser.webkit)d=c;$("#jquery_jplayer").jPlayer({ready:function(){j=this.element},oggSupport:c,volume:100,nativeSupport:d,swfPath:"/js"});$("a.expandTrackList").click(function(h){var e="ui-icon-triangle-1-s",a="ui-icon-triangle-1-e",d=this;h.preventDefault();var b=$(d).parents(B).find(".expandable");b.toggle("blind",f,200);if($(d).hasClass(a)){$(d).removeClass(a);$(d).addClass(e);if(Shared.Common.IsEmpty(b.html())){b.html(Shared.Common.ProgressImage);var g=$(d).attr(k);$.ajax({type:"GET",url:g,dataType:"html",cache:c,success:function(a){b.html(a);R(b);if(K){K=c;F(b);L()}},error:function(a){b.html(a.responseText)}})}}else{$(d).removeClass(e);$(d).addClass(a)}});$("a.playCollectionButton").click(function(d){d.preventDefault();var c=$(this);if(c.hasClass(e)||c.hasClass(a))S(c);else c.hasClass(b)&&N(c)});$("a.playSingleButton").click(function(d){d.preventDefault();var c=$(this);if(c.hasClass(e)||c.hasClass(a))U(c);else c.hasClass(b)&&N(c)})};function U(b){var c=b.parents(h).find(E);if(b.hasClass(a))J(d[g]);else{z();F(c);L()}o(b)}function S(b){var c=b.parents(h).find(E);if(b.hasClass(a))J(d[g]);else{z();if(!c.is(p)){K=true;c.parents(B).find(".expandTrackList").click()}else{F(c);L()}}o(b)}function N(a){O(d[g]);I(a)}function o(c){if(c.hasClass(e)||c.hasClass(a)){c.removeClass(e).removeClass(a).addClass(b);var d=c.find(q);d.addClass(r);d.removeClass(s);d.next(t).html("Pause");c.attr(u,"Pause");c.addClass(v)}}function I(c){if(c.hasClass(b)){c.removeClass(b).addClass(a);var d=c.find(q);d.removeClass(r);d.addClass(s);d.next(t).html(w);c.attr(u,"Resume");c.removeClass(v)}}function H(c){if(c.hasClass(b)||c.hasClass(a)){c.removeClass(b).removeClass(a).addClass(e);var d=c.find(q);d.removeClass(r);d.addClass(s);d.next(t).html(w);c.attr(u,w);c.removeClass(v)}}function L(){d.length>0&&A(d[0])}function F(a){d=[];g=0;a.find(n).each(function(b){var a=$(this);a.attr(C,b);d[b]=a});G=a.attr("id")}function z(){d!=f&&Q(d[g]);d=f;g=0;D!=f&&D.is(p)&&D.fadeOut(500);G=""}function A(a){g=parseInt(a.attr(C));$(n).not(a).each(function(){Q($(this))});var f=$(a).parents(h).find(l);T(f);var e=$(a).find(i),q=e.attr(k),p=q+"/MP3";j.jPlayer("setFile",p);j.jPlayer("onSoundComplete",function(){if(d.length-1>g)A(d[g+1]);else if(P)A(d[0]);else z()});j.jPlayer("play");o(e);M(a,true);var c=f.parents(m).find(x);!c.hasClass(b)&&o(c)}function O(c){j.jPlayer("pause");var d=$(c).find(i);I(d);var e=$(c).parents(h).find(l),b=e.parents(m).find(x);!b.hasClass(a)&&I(b)}function J(c){j.jPlayer("play");var d=$(c).find(i);o(d);var e=$(c).parents(h).find(l),a=e.parents(m).find(x);!a.hasClass(b)&&o(a)}function Q(a){try{j.jPlayer("stop")}catch(g){}var d=$(a).find(i);H(d);M(a,c);var f=$(a).parents(h).find(l),b=f.parents(m).find(".playerButton");!b.hasClass(e)&&H(b)}function M(d,c){var a="font-weight",b=d.find(y);b.css(a,c?"bold":"normal");$(y).not(b).css(a,"normal")}function T(a){var c=".nextButton",b=".prevButton";D=a;!a.is(p)&&a.fadeIn(500);if(!a.hasClass("wired")){a.find(".stopButton").click(function(a){a.preventDefault();z()});if(d.length>1){a.find(b).click(function(a){a.preventDefault();g>0&&A(d[g-1])});a.find(c).click(function(a){a.preventDefault();d.length-1>g&&A(d[g+1])})}else{a.find(b).hide();a.find(c).hide()}a.find(".repeatButton").click(function(b){var a="ui-state-active";b.preventDefault();$(this).toggleClass(a);P=$(this).hasClass(a)});a.addClass("wired")}var f=a.find(".playProgress"),i=a.find(".playTime"),h=a.find(".totalTime"),e=a.find(".loadProgress");e.progressbar();f.progressbar();j.jPlayer("onProgressChange",function(d,k,b,g,j){var c=parseInt(d),a=parseInt(b);e.progressbar("option","value",c);f.progressbar("option","value",a);i.text($.jPlayer.convertTime(g));h.text($.jPlayer.convertTime(j))})}function R(g){$(g).find(y).click(function(d){d.preventDefault();var a=$(this).next(".audioWorkDetailContainer");a.toggle("blind",f,200);if(Shared.Common.IsEmpty(a.html())){a.html(Shared.Common.ProgressImage);var b=$(this).attr(k);$.ajax({type:"GET",url:b,dataType:"html",cache:c,success:function(b){a.html(b)},error:function(b){a.html(b.responseText)}})}});$(g).find(i).click(function(i){i.preventDefault();g.attr("id")!=G&&z();d==f&&F(g);var c=$(this),h=$(this).parents(n);if(c.hasClass(e))A(h);else if(c.hasClass(b))O(h);else c.hasClass(a)&&J(h)});Shared.WorkList.HijaxDownloadLinks();Shared.Common.HijaxButtonHoverStates()}};$(function(){Shared.WorkList.HijaxProfileLinks();Shared.WorkList.HijaxDescriptionLinks();Shared.WorkList.HijaxDownloadLinks();Shared.WorkList.HijaxImageLinks();Shared.WorkList.HijaxCommentLinks();Shared.PlayerManager.SetupPlayers()});if(!window.Music)window.Music={};Music.DownloadForm=new function(){var a=this;a.Ready=function(){Shared.Common.HijaxButtonHoverStates();$(".confirmDownloadButton").click(function(){$("#downloadWindow").dialog("close")})}};$(".pageLink:not(.ui-state-disabled)").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});if(!window.Comments)window.Comments={};Comments.CommentList=new function(){var a="href",b=".addComment",c=this;c.HijaxComments=function(){var d=".commBox";$(b).click(function(b){b.preventDefault();var a=$(b.target),f=a.parents(".addBox");f.hide();var c=a.parents(d);e(a,c)});$(".pageLink").click(function(f){f.preventDefault();var b=$(f.target),e;if(b.is("a"))e=b.attr(a);else e=b.parent("a").attr(a);var g=b.parents(d);b.html("loading...");b.addClass("ui-state-disabled");$.get(e,function(a){g.html(a);c.HijaxComments()})})};function e(f,c){var b=".formBox",e=c.find(b);if(Shared.Common.IsEmpty(e.html())){e.html(Shared.Common.ProgressImage);var g=$(f).attr(a),h=$.get(g,function(h){var a=f.parent().next(b);a.html(h);var e=a.find("form");Comments.CommentForm.HijaxForm(e);var g=e.find("a.cancel");g.click(function(c){c.preventDefault();a.html("");var b=a.parent().find(".addBox");b.show()});e.submit(function(){d(e,c);return false})})}}function d(e,d){if(e.valid()){var f=e.attr("action");$.ajax({type:"POST",url:f,data:e.serialize(),dataType:"json",success:function(e){d.html(Shared.Common.ProgressImage);Shared.Common.ShowUserMessage(e);var g=d.prev(".expandComm"),f=g.attr(a);$.ajax({type:"GET",url:f,success:function(g){d.html(g);c.HijaxComments();if(e.Message.indexOf("Welcome",0)!=-1){var f=d.find(b);f.click()}else{var a=d.find(".comment:first");a.addClass("ui-state-highlight")}}})},error:function(a){d.html(a.responseText)}})}}};if(!window.Comments)window.Comments={};Comments.CommentForm=new function(){var a=this;a.HijaxForm=function(a){$.getScript("/Scripts/jquery.validate.min.js",function(){$(a).validate({errorClass:"ui-state-error",errorElement:"div",rules:{CommentText:{required:true,maxlength:1e3}}})});a.find("textarea:first").focus()}}